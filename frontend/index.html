<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Walmart Waste Predictor – AI‑Powered Food Waste Management</title>
    <meta name="description" content="Revolutionary AI‑driven solution for predicting and reducing food waste at Walmart. Real‑time demand forecasting, smart redistribution, and gamified leaderboards for maximum efficiency." />
    <meta name="author" content="Walmart Sparkathon Team" />
    <meta name="keywords" content="walmart, food waste, AI prediction, demand forecasting, sustainability, retail analytics" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type"        content="website" />
    <meta property="og:url"         content="https://walmart-waste-predictor.onrender.com" />
    <meta property="og:title"       content="Walmart Waste Predictor – AI‑Powered Food Waste Management" />
    <meta property="og:description" content="Revolutionary AI solution reducing food waste through predictive analytics, real‑time alerts, and smart redistribution strategies." />
    <meta property="og:image"       content="https://walmart-waste-predictor.onrender.com/og-image.jpg" />

    <!-- Twitter -->
    <meta name="twitter:card"        content="summary_large_image" />
    <meta name="twitter:url"         content="https://walmart-waste-predictor.onrender.com" />
    <meta name="twitter:title"       content="Walmart Waste Predictor – AI‑Powered Food Waste Management" />
    <meta name="twitter:description" content="Revolutionary AI solution reducing food waste through predictive analytics and smart redistribution." />
    <meta name="twitter:image"       content="https://walmart-waste-predictor.onrender.com/og-image.jpg" />

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config', 'GA_MEASUREMENT_ID');
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Lovable UI built CSS & JS -->
    <link rel="stylesheet" href="/assets/index-CF7nD4AK.css" />
    <script type="module" src="/assets/index-BOC2bd3T.js"></script>

    <!-- Custom dashboard styles -->
    <style>
      * { box-sizing: border-box; }
      body { font-family: 'Segoe UI', sans-serif; background: #f4f6f9; margin: 0; }

      .sidebar {
        height: 100%; width: 250px; position: fixed; top: 0; left: -250px;
        background-color: #003087; overflow-x: hidden; transition: 0.3s;
        padding-top: 60px; z-index: 1000;
      }
      .sidebar a {
        padding: 16px 24px; text-decoration: none; font-size: 18px;
        color: #fff; display: block;
      }
      .sidebar a:hover { background-color: #0050c2; }
      .openbtn {
        font-size: 24px; cursor: pointer; background-color: #003087; color: white;
        padding: 12px 18px; border: none; position: fixed; top: 10px; left: 10px; z-index: 1100;
      }

      .bell-icon, .chart-icon {
        position: fixed; top: 14px; font-size: 24px; cursor: pointer; z-index: 1100;
      }
      .bell-icon { right: 60px; }
      .chart-icon { right: 20px; }

      .alert-box, .chart-popup {
        position: fixed; background: white; border: 1px solid #ccc;
        border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); padding: 16px;
        display: none; z-index: 1200;
      }
      .alert-box {
        top: 50px; right: 60px; width: 320px; max-height: 400px; overflow-y: auto;
      }
      .chart-popup {
        top: 50px; right: 20px; width: 360px; height: 250px;
      }

      #main { padding: 20px; margin-left: 0; transition: margin-left 0.3s; }
      .container {
        background: white; border-radius: 10px; padding: 30px;
        margin: 20px auto; max-width: 1100px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
      }
      h2 { text-align: center; color: #003087; }
      label { display: block; margin: 10px 0 6px; font-weight: bold; }
      input, select {
        width: 100%; padding: 10px; font-size: 16px; margin-bottom: 12px;
        border-radius: 6px; border: 1px solid #ccc;
      }
      button {
        background-color: #0071ce; color: white; padding: 10px 20px;
        border: none; border-radius: 6px; font-size: 16px; cursor: pointer;
      }
      button:hover { background-color: #005bbb; }
      table {
        width: 100%; border-collapse: collapse; margin-top: 20px;
      }
      th, td {
        border: 1px solid #ddd; padding: 12px; text-align: center;
      }
      th { background-color: #0071ce; color: white; }
      tr:nth-child(even) { background-color: #f2f2f2; }

      .result { margin-top: 12px; font-weight: bold; }
      .page { display: none; }
      .active { display: block; }

      .welcome {
        text-align: center; margin-top: 100px; font-size: 26px;
        color: #003087;
      }
      .alert-item {
        border-bottom: 1px solid #eee; padding: 10px 0; font-size: 14px;
      }
    </style>
  </head>

  <body>
    <!-- Lovable React app root (if you plan to use it) -->
    <div id="root"></div>

    <!-- Custom dashboard markup -->
    <div id="mySidebar" class="sidebar">
      <a href="javascript:void(0)" onclick="navigate('page1')">📈 Demand Forecast</a>
      <a href="javascript:void(0)" onclick="navigate('page2')">🗑 Waste Risk</a>
      <a href="javascript:void(0)" onclick="navigate('page3')">📦 Smart Recommendations</a>
      <a href="javascript:void(0)" onclick="navigate('page4')">🏁 AI Leaderboard</a>
      <a href="javascript:void(0)" onclick="navigate('page5')">📉 Waste Forecast</a>
    </div>
    <button class="openbtn" onclick="toggleSidebar()">☰</button>
    <div class="bell-icon" onclick="toggleAlerts()">🔔</div>
    <div class="chart-icon" onmouseenter="showChart()" onmouseleave="hideChart()">📊</div>
    <div id="alertBox" class="alert-box"></div>
    <div id="chartPopup" class="chart-popup"><canvas id="wasteChart"></canvas></div>

    <div id="main">
      <div id="welcome" class="welcome">
        <h1>👋 Welcome to Walmart Waste Predictor</h1>
        <p>Click ☰ to explore our AI‑powered dashboard.</p>
      </div>

      <!-- Page 1: Demand Forecast -->
      <div id="page1" class="page container">
        <h2>📈 Demand Forecast</h2>
        <label>Previous Sales</label><input type="number" id="df_prev"/>
        <label>Stock</label><input type="number" id="df_stock"/>
        <label>Temperature (°C)</label><input type="number" id="df_temp"/>
        <button onclick="forecastDemand()">Predict Demand</button>
        <div id="df_result" class="result"></div>
      </div>

      <!-- Page 2: Waste Risk -->
      <div id="page2" class="page container">
        <h2>🗑 Waste Risk Prediction</h2>
        <label>Stock</label><input type="number" id="wr_stock"/>
        <label>Freshness Score</label><input type="number" step="0.01" id="wr_fresh"/>
        <label>Days to Expiry</label><input type="number" id="wr_expiry"/>
        <button onclick="predictWaste()">Predict Risk</button>
        <div id="wr_result" class="result"></div>
      </div>

      <!-- Page 3: Smart Bulk -->
      <div id="page3" class="page container">
        <h2>📦 Smart Bulk Recommendations</h2>
        <input type="file" id="smart_csv" accept=".csv"/><button onclick="uploadSmartCSV()">Upload & Analyze</button>
        <div id="smart_result" class="result"></div>
        <table id="smart_table"></table>
      </div>

      <!-- Page 4: AI Leaderboard -->
      <div id="page4" class="page container">
        <h2>🏁 AI Leaderboard</h2>
        <input type="file" id="leader_csv" accept=".csv"/><button onclick="uploadLeaderboard()">Upload Report</button>
        <div id="leader_msg" class="result"></div>
        <h3>📅 Today</h3><table id="daily_leader"></table>
        <h3>📆 Monthly</h3><table id="monthly_leader"></table>
      </div>

      <!-- Page 5: Waste Forecast -->
      <div id="page5" class="page container">
        <h2>📉 Waste Forecast</h2>
        <input type="file" id="waste_csv" accept=".csv"/><button onclick="uploadWasteCSV()">Forecast Waste</button>
        <table id="waste_table"></table>
      </div>
    </div>

    <!-- Custom dashboard scripts -->
    <script>
      const BASE = window.location.origin;
      let chartInstance = null, latestAlerts = [];

      function toggleSidebar() {
        const bar = document.getElementById("mySidebar");
        bar.style.left = bar.style.left==='0px' ? '-250px' : '0px';
      }
      function navigate(id) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        welcome.style.display='none'; 
        mySidebar.style.left='-250px';
        alertBox.style.display='none';
      }
      function toggleAlerts() {
        const box=alertBox;
        box.style.display=box.style.display==='block'?'none':'block';
        box.innerHTML="<h4>⚠️ Smart Alerts</h4><hr>";
        if(!latestAlerts.length) box.innerHTML+="<p>No critical alerts!</p>";
        else latestAlerts.forEach(a=>{
          box.innerHTML+=`
            <div class="alert-item">
              🔎 <b>${a.name}</b> (${a.store_location})<br>
              📦 Stock: ${a.stock}, 📈 Demand: ${a.daily_demand}<br>
              🧾 Expiry: ${a.expiry_date}<br>
              🧠 Alert: <b>${a.alert_reason}</b>
            </div>`;
        });
      }
      async function forecastDemand() {
        const res=await fetch(`${BASE}/forecast_demand`,{
          method:'POST',headers:{'Content-Type':'application/json'},
          body:JSON.stringify({
            previous_sales:+df_prev.value,stock:+df_stock.value,temperature_C:+df_temp.value
          })
        }),j=await res.json();
        df_result.innerText="Forecasted Demand: "+j.forecasted_demand;
      }
      async function predictWaste() {
        const res=await fetch(`${BASE}/predict`,{
          method:'POST',headers:{'Content-Type':'application/json'},
          body:JSON.stringify({
            stock:+wr_stock.value,freshness_score:+wr_fresh.value,days_to_expiry:+wr_expiry.value
          })
        }),j=await res.json();
        wr_result.innerText="Prediction: "+j.prediction;
      }
      async function uploadSmartCSV() {
        const fd=new FormData();fd.append('file',smart_csv.files[0]);
        const j=await (await fetch(`${BASE}/upload_csv`,{method:'POST',body:fd})).json();
        latestAlerts=j.alerts||[];smart_result.innerText="Recommendations Loaded!";
        smart_table.innerHTML="<tr>"+Object.keys(j.recommendations[0]).map(k=>`<th>${k}</th>`).join('')+"</tr>";
        j.recommendations.forEach(r=>smart_table.innerHTML+=`<tr>${Object.values(r).map(v=>`<td>${v}</td>`).join('')}</tr>`);
      }
      async function uploadLeaderboard() {
        const fd=new FormData();fd.append('file',leader_csv.files[0]);
        await fetch(`${BASE}/upload_waste_ai`,{method:'POST',body:fd});
        leader_msg.innerText="Report uploaded!";
        const daily=await (await fetch(`${BASE}/ai_daily_leaderboard`)).json(),
              monthly=await (await fetch(`${BASE}/ai_monthly_leaderboard`)).json();
        ['daily_leader','monthly_leader'].forEach((id,i)=>{
          const data=i?monthly:daily, tbl=document.getElementById(id);
          tbl.innerHTML="<tr>"+Object.keys(data[0]).map(k=>`<th>${k}</th>`).join('')+"</tr>";
          data.forEach(r=>tbl.innerHTML+=`<tr>${Object.values(r).map(v=>`<td>${v}</td>`).join('')}</tr>`);
        });
      }
      async function uploadWasteCSV() {
        const fd=new FormData();fd.append('file',waste_csv.files[0]);
        const j=await (await fetch(`${BASE}/forecast_waste`,{method:'POST',body:fd})).json();
        waste_table.innerHTML=j.length
          ? "<tr>"+Object.keys(j[0]).map(k=>`<th>${k}</th>`).join('')+"</tr>"+j.map(r=>`<tr>${Object.values(r).map(v=>`<td>${v}</td>`).join('')}</tr>`).join('')
          : "<tr><td>No forecast data available</td></tr>";
      }
      async function showChart() {
        chartPopup.style.display='block';
        const j=await (await fetch(`${BASE}/combined_chart_data`)).json();
        const ctx=wasteChart.getContext('2d');
        if(chartInstance)chartInstance.destroy();
        chartInstance=new Chart(ctx,{
          type:'bar',
          data:{labels:j.forecast_chart.labels,datasets:[{label:'Waste Generated (kg)',data:j.forecast_chart.data,backgroundColor:'rgba(0,112,192,0.5)',borderColor:'#0070c0',borderWidth:2}]},
          options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true}}}
        });
      }
      function hideChart(){chartPopup.style.display='none';}
    </script>
  </body>
</html>
